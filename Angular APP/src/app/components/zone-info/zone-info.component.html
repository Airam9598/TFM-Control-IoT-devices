<section>
    <h2>{{this.dataService.actZone.name}}</h2>
    <button *ngIf='isButtonVisible(["admin","zones"])' class="conf" (click)="this.showZone=true"><i class="bi bi-gear-fill"></i>Configuración</button>
    <button class="close" (click)="closePanel()" >X</button>
    <div class="box">
        <div class="info" *ngIf='isButtonVisible(["admin","irrigate"])'>
            <div class="orange" *ngIf='this.devicesclasified["air temperature"].length>0'>
                Temperatura del aire
                <div>
                    <img src="../../../assets/temp.png">
                    <p id='Info air temperature'>{{this.devicesclasified["air temperature"][0].info.data["air temperature"].value}}°</p>
                </div>
                <select (change)="changeValue('air temperature',$event)" *ngIf="this.devicesclasified['air temperature'].length>1">
                    <option *ngFor="let dev of this.devicesclasified['air temperature']" value="{{dev.id}}" >{{dev.name}}</option>
                </select>
            </div>
            <div class="orange2" *ngIf='this.devicesclasified["soil temperature"].length>0 && this.devicesclasified["soil temperature"][0].info'>
                Temperatura del suelo
                <div>
                    <img src="../../../assets/temp.png">
                    <p id='Info soil temperature'>{{this.devicesclasified["soil temperature"][0].info.data["soil temperature"].value}}°</p>
                </div>
                <select (change)="changeValue('soil temperature',$event)" *ngIf="this.devicesclasified['soil temperature'].length>1">
                    <option *ngFor="let dev of this.devicesclasified['soil temperature']" value="{{dev.id}}" >{{dev.name}}</option>
                </select>
            </div>

            <div class="blue3" *ngIf='this.devicesclasified["soil Moisture"].length>0 && this.devicesclasified["soil Moisture"][0].info'>
                Humedad del suelo
                <div>
                    <img src="../../../assets/moisture.png">
                    <p id='Info soil Moisture'>{{(this.devicesclasified["soil Moisture"][0].info.data["soil Moisture"].value* 100).toFixed(2)}}</p>
                </div>
                <select (change)="changeValue('soil Moisture',$event)" *ngIf="this.devicesclasified['soil Moisture'].length>1">
                    <option *ngFor="let dev of this.devicesclasified['soil Moisture']" value="{{dev.id}}" >{{dev.name}}</option>
                </select>
            </div>

            <div class="blue2" *ngIf='this.devicesclasified["precipitation"].length>0'>
                Precipitación
                <div>
                    <img src="../../../assets/water.png">
                    <p id='Info precipitation'>{{this.devicesclasified["precipitation"][0].info.data["precipitation"].value}}mm</p>
                </div>
                <select (change)="changeValue('precipitation',$event)" *ngIf="this.devicesclasified['precipitation'].length>1">
                    <option *ngFor="let dev of this.devicesclasified['precipitation']" value="{{dev.id}}" >{{dev.name}}</option>
                </select>
            </div>
        </div>
        <div class="actions">
            <button (click)="this.dataService.devices=[]" *ngIf="this.dataService.devices.length>0 && isButtonVisible(['admin','history'])" class="blue" [routerLink]='["/history"]' [state]="{ name:this.dataService.actZone}"><img src="../../../assets/graph.png"> Historial</button>
            <button (click)="changeIrrigate()" *ngIf='devicesclasified["irrigate"].length>0 && !this.irrigate && isButtonVisible(["admin","irrigate"])' class="green"><img src="../../../assets/water.png"> Regar</button>
            <button (click)="changeIrrigate()" *ngIf='devicesclasified["irrigate"].length>0 && this.irrigate && isButtonVisible(["admin","irrigate"])' class="irrigate"><img src="../../../assets/water.png"> Regando...</button>
            <button *ngIf='devicesclasified["camera"].length>0 && isButtonVisible(["admin","camera"])' class="gray" (click)="this.showCameras=true"><img src="../../../assets/camera.png"> Cámaras</button>
            <button class="gray" (click)="this.showDevices=true"><img src="../../../assets/device.png"> Dispositivos</button>
            <button class="yellow"(click)="showAdvise=true"><img src="../../../assets/settings.png"> Avisos</button>
        </div>
    </div>
</section>

<app-general-list (setDeviceEvent)="this.classify()" (closeEvent)="this.showDevices=false" *ngIf="this.showDevices" [title]="'Dispositivos'" [type]="'device'"></app-general-list>
<app-general-list (closeEvent)="this.showCameras=false" *ngIf="this.showCameras" [title]="'Cámaras'" [type]="'camera'"></app-general-list>

<app-general-form (deleteEvent)="this.deleteZone.emit()" *ngIf="this.showZone && isButtonVisible(['admin','zones'])" (closeEvent)="this.showZone=false" [elements]="zoneElements" [formGroup]="zoneFormGroup" [title]="'Crear Zona'" [error]="errorMessage"  [editedItem]="this.dataService.actZone" (submited)="createZone($event)"></app-general-form>
<app-advisor (closeEvent)="this.showAdvise=false" *ngIf="showAdvise"></app-advisor>
